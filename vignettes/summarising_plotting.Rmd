---
title: "Summarising & Plotting"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Summarising & Plotting}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  out.width = "100%",
  fig.width = 6,
  fig.asp = 0.618,
  fig.align = "center",
  dpi = 300
)
```

Different measuring devices and analysis software lead to opaque results in measuring gas exchange parameters. To make exercise science more transparent and reproducible, the `spiro` package offers a standardised workflow for data from metabolic carts.

This vignette provides you information on how to summarise and plot data previously imported and processed by `spiro()`.

#### Load the data

```{r setup}
library(spiro)

# import and process example data
file <- spiro_example("zan_gxt")
gxt_data <- spiro(file)
gxt_data

```

## Stepwise summary with `spiro_summary()`

To analyse gas exchange data, usually mean parameters for each performed load step are warranted. To ensure the presence of a metabolic steady state, the end of each step is used for calculations.

```{r spiro_summary}
spiro_summary(gxt_data, interval = 120)
```

The length of the computational interval (in seconds) can be modified by setting
the `interval` argument. If the interval exceed the length of any step in any
case, it will be shortened displaying a note. You can turn these messages of
with setting the argument `quiet = TRUE`.

## Maximal parameter values with `spiro_max()`

For some types of exercise tests it may be preferable to get an overall instead
of a stepwise summary of parameters. `spiro_max()` calculates the maximal values
within the test after applying a smoothing by the use of a rolling average.

```{r spiro_glance}
spiro_max(gxt_data, smooth = 30)
```
The `interval` argument will set the length over which the rolling average will
be computed.

## Plotting the data

The `spiro` package offers basic shorthand functions for visualizing data from cardiopulmonary exercise testing. With `spiro_plot()` you can display the traditional Wasserman 9-Panel Plot.

```{r spiro_plot}
# load example data
data <- spiro(spiro_example("zan_ramp"), 
                      hr_file = spiro_example("hr_ramp.tcx"))

spiro_plot(data)
```

You can combine selected panels of the 9-Panel Plot by setting the `which` argument.

```{r spiro_plot_which}
# Plot only V-Slope (Panel 5) and VO2/VCO2 over time (Panel 3)
spiro_plot(data, which = c(5,3))
```
