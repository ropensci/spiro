---
title: "Summarising & Plotting"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Summarising & Plotting}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  out.width = "100%",
  fig.width = 6,
  fig.asp = 0.618,
  fig.align = "center",
  dpi = 300
)
```

Different measuring devices and analysis software lead to opaque results in measuring gas exchange parameters. To make exercise science more transparent and reproducible, the `spiro` package offers a standardised workflow for data from metabolic carts.

This vignette provides you information on how to summarise and plot data previously imported and processed by `spiro()`.

#### Load the data

```{r setup}
library(spiro)

# import and process example data
file <- spiro_example("zan_gxt")
gxt_data <- spiro(file)
gxt_data

```

## Stepwise summary with `spiro_summary()`

To analyse gas exchange data, usually mean parameters for each performed load step are warranted. To ensure the presence of a metabolic steady state, the end of each step is used for calculations.

```{r spiro_summary}
spiro_summary(gxt_data, interval = 120)
```

The length of the computational interval (in seconds) can be modified by setting
the `interval` argument. If the interval exceed the length of any step in any
case, it will be shortened displaying a note.

## Maximal parameter values with `spiro_max()`

For some types of exercise tests it may be preferable to get an overall instead
of a stepwise summary of parameters. `spiro_max()` calculates the maximal values
within the test after applying a smoothing by the use of a rolling average.

```{r spiro_glance}
spiro_max(gxt_data, interval = 30)
```
The `interval` argument will set the length over which the rolling average will
be computed.

## Plotting the data

To plot exercise test data handled by `spiro()` it is recommend to use specific
visualisation packages such as `ggplot2` on the data. However, to provide a
quick view on the compiled data (e.g. for checking if the import operated
correctly) the `spiro` package offers basic shorthand functions of data
visualisation.

### Plotting oxygen uptake data

In many cases, the (relative) oxygen uptake will be the parameter of most
interest when analysing spiroergometric data. `spiro_plot_VO2()` visualises the
interpolated oxygen uptake data, it's rolling average and the
underlying protocol load.

The length of the computational interval for the rolling average can be changed
by setting the `smooth` argument. To allow a further check for correct
importing, setting the `title` argument to `TRUE` will create a plot title with
the participant's name and the test type.

```{r spiro_plot_VO2, warning=FALSE}
spiro_plot_VO2(gxt_data, 
               smooth = 15,
               title = FALSE
               )
```

### Plotting heart rate data

To verify the presence of correct heart rate data, `spiro_plot_HR()` provides an
easy option of visualising the data together with the protocol load data.

To allow a further check for correct importing, setting the `title` argument to
`TRUE` will create a plot title with the participant's name and the test type.

```{r spiro_plot_HR, warning=FALSE}
# load example data
data_with_hr <- spiro(spiro_example("zan_ramp"), 
                      hr_file = spiro_example("hr_ramp.tcx"))

spiro_plot_HR(data_with_hr, 
              title = FALSE
              )
```
